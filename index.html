<html>
<head>
	<title>Assignment 4</title>
	<link type="text/css" rel="stylesheet" href="wordStyle.css"/>
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script type="text/javascript">
  var originalWords = new Array();
	var correctAnagrams = new Array();
	var guesses = new Array ();
	var currentWord = "";
	var mostRecentGuess = "";
	var counter = 1;
	
function clientSideChecks() {
				
		if (currentWord == "") {
			$("#errormsg").text("You must click the button above to get a new word first!");
			$("#userinput").val("");
			return false;
		}
		
		mostRecentGuess = $(userinput).val();
	
		if (mostRecentGuess == currentWord) {
			$("#errormsg").text("A word is not an anagram of itself.");
			$("#userinput").val("");
			return false;
		}
	
		if (mostRecentGuess == "") {
			$("#errormsg").text("You didn't enter a guess.");
			$("#userinput").val("");
			return false;
		}
	
		var isValid = checkAnagram(currentWord, mostRecentGuess);

		// Test 1 (client): Can the word be made from those letters?		
		if (!isValid){
			$("#errormsg").text("That is not an anagram of \"" + currentWord + "\".");
			$("#userinput").val("");
			return false;
		}
		
		if (correctAnagrams.indexOf(mostRecentGuess) != -1) {
				$("#errormsg").text("You already guessed that word.");
				$("#userinput").val("");
				return false;
		}
	
		else {
				return true;	
				}
	
		}
	

function checkAnagram(original, guess) {
	
	var foundAt;
	originalChars = original.split("");
	guessChars = guess.split("");
	
	for (var i = 0; i < guessChars.length; i++) {
		foundAt = originalChars.indexOf(guessChars[i]);
		
			// If the letter is present...
			if (foundAt >= 0) {
				delete originalChars[foundAt];
			}
			
			// If the letter is absent...
			else {
				return false;
			}
		}
	// If the loop ended, then all letters were present.
	return true;
	}

function checkWord() {

				// Get the xml data from POST
				$.post("checkWord.php", { guess: mostRecentGuess}, function(data) { 

					// Extract the word from XML response
					var response = $(data).find('Word').children().text();

					if (response != mostRecentGuess) {
						$("#errormsg").text("That word is not in the dictionary.");
						$("#userinput").val("");
						return false;
					}
					
					// Add the correct guess to the list of anagrams
					correctAnagrams.push(response);
					//alert(correctAnagrams);
					
					// Add the anagram to the appropriate data cell
			   	$("#" + currentWord).append("" + counter + ". " + response + "<br>"); 
					$("#userinput").val("");
					$("#errormsg").text("");
					counter++;
					return true;
					 });
					 return true;
				}

function getNewWord() {

			// Get the xml data from POST
			$.post("getWord.php", "", function(data) { 

				// Extract the word from XML response
				var word = $(data).find('Word').children().text();

				// Add word to list of words
				originalWords.push(word);
				
				// Add the word to the table along with an empty cell for guesses related to it
		   	$("#thetable").append("<tr><td><b>" + word + "</b></td><td id='" + word + "'></td></tr>"); 

				$("#errormsg").text("");
				currentWord = word;
				counter = 1;
				correctAnagrams = new Array();
				 });
			}
				
	// Makes it so that pressing enter submits the current word
	$(document).keypress(function(e) {
		    if(e.which == 13) {
		        if (clientSideChecks()) {
							if (checkWord()) {
								
							}
						}
		    }
			});
				
// function getNewWord() {
// //			//alert("I work");
// 			$.post("getWord.php", "", function(data) { 
// 			
// 				 var word = $(data).find('Word').children().text();
// 	
// 				 if(wordsObject.indexOf(word) != -1) {
//  					//alert(word + " in wordsObject already.");
// 					countObject[wordsObject.indexOf(word)] += 1;
// 					var temp = $("#" + word).html();
// 					$("#" + word).html(++temp);
//  						}
//  						//and set number to 1
//  				
// 				else {
// 					wordsObject.push(word);
// 					//alert(word + " not in object yet. Array : " + wordsObject.length);
// 					countObject.push(1);
// 					var wordCount = countObject[wordsObject.indexOf(word)];
// 					//alert(wordCount);
//  		   		$("#thetable").append("<tr><td>" + word + "</td><td id='" + word + "'> " + wordCount + "</td></tr>"); 
// 					//+ countObject[wordsObject.indexOf(word)] "</td></tr>");
//  					//increase number by 1
//  						}
// 
// 				 });
// 				}

</script>

</head>
<body>
	<center>
	<h1>The Anagram Game</h1>
	<button id="newword" onclick="getNewWord()">Get a new word</button><br><br>
	<table id="thetable" border="1" style="width:30%"><tr><th>Original word</th><th>Anagrams</th></tr></table><br>
	<input id="userinput" type="text" length="30" autocomplete="off" autofocus="autofocus"></input><br>
	<p><h4><span id="errormsg"></span></h4>
	</center>
</body>
</html>